<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #fbbc05;
            --danger: #ea4335;
            --dark: #202124;
            --light: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.15);
            --text-light: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
            --rain: #4a90e2;
            --winter: #4fc3f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f4c75, #3282b8, #bbe1fa);
            color: var(--text-light);
            min-height: 100vh;
            padding: 15px;
            transition: background 1.5s ease;
        }

        body.sunny {
            background: linear-gradient(135deg, #36D1DC, #5B86E5, #FFD200);
        }

        body.cloudy {
            background: linear-gradient(135deg, #636FA4, #636FA4, #E8CBC0);
        }

        body.rainy {
            background: linear-gradient(135deg, #2C3E50, #4CA1AF, #2C3E50);
        }

        body.night {
            background: linear-gradient(135deg, #0F2027, #203A43, #2C5364);
        }

        body.winter {
            background: linear-gradient(135deg, #0f4c75, #3282b8, #bbe1fa);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 2rem;
            color: var(--winter);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--winter);
        }

        .search-container {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 100%;
        }

        .search-box {
            display: flex;
            width: 100%;
            background: var(--card-bg);
            border-radius: 50px;
            padding: 12px 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-light);
            font-size: 1rem;
            padding: 5px;
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-box button {
            background: transparent;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0 5px;
        }

        .voice-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .voice-btn.listening {
            background: var(--danger);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .units-toggle {
            display: flex;
            background: var(--card-bg);
            border-radius: 50px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .units-toggle button {
            background: transparent;
            border: none;
            color: var(--text-light);
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .units-toggle button.active {
            background: var(--primary);
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .current-weather {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
        }

        .live-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: var(--winter);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .location {
            font-size: 1.6rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-time {
            font-size: 1rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .weather-icon {
            font-size: 5rem;
            margin: 15px 0;
            color: var(--winter);
            transition: transform 0.5s ease;
        }

        .weather-icon.animate {
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .temperature {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 1s ease;
        }

        .temperature.changing {
            animation: pulseTemp 1s ease;
        }

        @keyframes pulseTemp {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); color: var(--winter); }
        }

        .description {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-transform: capitalize;
        }

        .details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .detail-item.changing {
            animation: glow 1s ease;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.1); }
            50% { box-shadow: 0 0 15px rgba(251, 188, 5, 0.5); }
        }

        .detail-item i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--winter);
        }

        .detail-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.5s ease;
        }

        .hourly-forecast {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hourly-container {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 8px 5px;
            -webkit-overflow-scrolling: touch;
        }

        .hourly-container::-webkit-scrollbar {
            height: 6px;
        }

        .hourly-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .hourly-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .hourly-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .hourly-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
        }

        .hourly-time {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .hourly-icon {
            font-size: 1.8rem;
            margin: 5px 0;
            color: var(--winter);
        }

        .hourly-temp {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .hourly-rain {
            font-size: 0.8rem;
            margin-top: 5px;
            color: var(--rain);
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab.active {
            background: var(--primary);
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .forecast-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .forecast-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
        }

        .forecast-date {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .forecast-icon {
            font-size: 2.2rem;
            margin: 8px 0;
            color: var(--winter);
        }

        .forecast-temp {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 8px 0;
        }

        .forecast-desc {
            font-size: 0.8rem;
            opacity: 0.9;
            text-transform: capitalize;
            margin-bottom: 8px;
        }

        .forecast-details {
            display: flex;
            justify-content: space-around;
            margin-top: 8px;
        }

        .forecast-detail {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .forecast-detail i {
            font-size: 0.9rem;
            margin-bottom: 5px;
            opacity: 0.7;
        }

        .forecast-detail span {
            font-size: 0.8rem;
        }

        .rain-forecast {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }

        .rain-chart {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 10px;
            margin: 20px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow-x: auto;
        }

        .rain-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 40px;
            cursor: pointer;
        }

        .rain-bar:hover .rain-bar-fill {
            background: linear-gradient(to top, #5a9ae6, #2a7de9);
        }

        .rain-amount {
            font-size: 0.8rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .rain-bar-fill {
            width: 30px;
            background: linear-gradient(to top, #4a90e2, #1a73e8);
            border-radius: 5px 5px 0 0;
            transition: all 0.5s ease;
        }

        .rain-date {
            font-size: 0.7rem;
            margin-top: 8px;
            text-align: center;
        }

        .rain-probability {
            font-size: 0.7rem;
            margin-top: 5px;
            color: var(--rain);
        }

        .rain-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .rain-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .rain-stat:hover {
            transform: scale(1.05);
        }

        .rain-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--rain);
        }

        .rain-stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .cities {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .city-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 15px;
            color: var(--text-light);
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .city-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.03);
        }

        .city-btn.active {
            background: var(--primary);
        }

        .city-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .city-temp {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            font-size: 1.3rem;
            margin: 25px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .spinner {
            width: 45px;
            height: 45px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--winter);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            background: rgba(234, 67, 53, 0.2);
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--danger);
            font-size: 0.9rem;
        }

        .voice-feedback {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: none;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .voice-feedback.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; bottom: 0; }
            to { opacity: 1; bottom: 20px; }
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            opacity: 0.8;
            font-size: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Clickable elements styling */
        .clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clickable:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }

        /* Mobile-specific optimizations */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            header {
                flex-direction: column;
                gap: 12px;
            }
            
            .search-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .voice-btn {
                align-self: center;
            }
            
            .current-weather {
                padding: 20px;
            }
            
            .temperature {
                font-size: 3rem;
            }
            
            .details {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .forecast-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .forecast-card {
                padding: 12px;
            }
            
            .forecast-date {
                font-size: 0.9rem;
            }
            
            .forecast-temp {
                font-size: 1.1rem;
            }
            
            .rain-chart {
                height: 120px;
            }
            
            .rain-bar {
                min-width: 30px;
            }
            
            .cities {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .city-btn {
                padding: 10px;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
            
            .search-container {
                flex-direction: row;
            }
            
            .main-content {
                display: grid;
                grid-template-columns: 1fr 1.5fr;
                gap: 25px;
            }
            
            .forecast-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .cities {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
        }

        @media (min-width: 992px) {
            .container {
                max-width: 960px;
            }
        }

        @media (min-width: 1200px) {
            .container {
                max-width: 1140px;
            }
        }
    </style>
</head>
<body class="winter">
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-snowflake"></i>
                <div>
                    <h1>Weather <span>App</span></h1>
                    <p style="font-size: 0.8rem; opacity: 0.8;"></p>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search city in Pakistan...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                
                <button class="voice-btn" id="voice-btn" title="Get voice weather report">
                    <i class="fas fa-microphone"></i>
                </button>
                
                <div class="units-toggle">
                    <button id="celsius-btn" class="active">°C</button>
                    <button id="fahrenheit-btn">°F</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="current-weather">
                <div class="live-indicator">
                    <i class="fas fa-circle"></i>
                    <span>LIVE</span>
                </div>
                <div class="location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="city-name">Islamabad</span>
                </div>
                <div class="date-time" id="current-date-time">Loading date and time...</div>
                <div class="weather-icon">
                    <i class="fas fa-snowflake" id="weather-icon"></i>
                </div>
                <div class="temperature" id="temperature">--°C</div>
                <div class="description clickable" id="weather-description" onclick="openWeatherDetails()">Loading...</div>
                
                <div class="details">
                    <div class="detail-item">
                        <i class="fas fa-wind"></i>
                        <div class="detail-label">Wind Speed</div>
                        <div class="detail-value" id="wind-speed">-- km/h</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-tint"></i>
                        <div class="detail-label">Humidity</div>
                        <div class="detail-value" id="humidity">--%</div>
                    </div>
                    <div class="detail-item clickable" onclick="openRainDetails()">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="detail-label">Rain Chance</div>
                        <div class="detail-value" id="rain-chance">--%</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-compress-arrows-alt"></i>
                        <div class="detail-label">Pressure</div>
                        <div class="detail-value" id="pressure">-- hPa</div>
                    </div>
                </div>
            </div>
            
            <div class="hourly-forecast">
                <h2 class="section-title"><i class="fas fa-clock"></i> Today's Forecast</h2>
                <div class="hourly-container" id="hourly-container">
                    <!-- Hourly items will be inserted here by JavaScript -->
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="5-day">5-Day Forecast</div>
                    <div class="tab" data-tab="15-day">15-Day Forecast</div>
                </div>
                
                <div id="forecast-container">
                    <!-- Forecast cards will be inserted here by JavaScript -->
                </div>
            </div>
        </div>

        <div class="rain-forecast">
            <h2 class="section-title"><i class="fas fa-cloud-rain"></i> 15-Day Rain Forecast</h2>
            <div class="rain-chart" id="rain-chart">
                <!-- Rain bars will be inserted here by JavaScript -->
            </div>
            <div class="rain-summary" id="rain-summary">
                <!-- Rain summary will be inserted here by JavaScript -->
            </div>
        </div>

        <h2 class="section-title" style="margin-top: 15px;"><i class="fas fa-city"></i> Major Cities</h2>
        <div class="cities" id="cities-container">
            <!-- City buttons will be inserted here by JavaScript -->
        </div>

        <div class="voice-feedback" id="voice-feedback">
            <i class="fas fa-microphone"></i>
            <span id="voice-text">Listening...</span>
        </div>

        <footer>
            <p>Weather App &copy;</p>
            
        </footer>
    </div>

    <script>
        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const voiceBtn = document.getElementById('voice-btn');
        const voiceFeedback = document.getElementById('voice-feedback');
        const voiceText = document.getElementById('voice-text');
        const celsiusBtn = document.getElementById('celsius-btn');
        const fahrenheitBtn = document.getElementById('fahrenheit-btn');
        const cityName = document.getElementById('city-name');
        const currentDateTime = document.getElementById('current-date-time');
        const weatherIcon = document.getElementById('weather-icon');
        const temperature = document.getElementById('temperature');
        const weatherDescription = document.getElementById('weather-description');
        const windSpeed = document.getElementById('wind-speed');
        const humidity = document.getElementById('humidity');
        const rainChance = document.getElementById('rain-chance');
        const pressure = document.getElementById('pressure');
        const hourlyContainer = document.getElementById('hourly-container');
        const forecastContainer = document.getElementById('forecast-container');
        const rainChart = document.getElementById('rain-chart');
        const rainSummary = document.getElementById('rain-summary');
        const citiesContainer = document.getElementById('cities-container');
        const tabs = document.querySelectorAll('.tab');
        const body = document.body;

        // App State
        let currentUnit = 'celsius';
        let currentCity = 'Islamabad';
        let isListening = false;
        let currentWeatherData = null;
        let updateInterval;
        const majorCities = [
            'Karachi', 'Lahore', 'Islamabad', 'Rawalpindi', 
            'Peshawar', 'Quetta', 'Faisalabad', 'Multan',
            'Gujranwala', 'Sialkot', 'Sargodha', 'Bahawalpur',
            'Sukkur', 'Jhang', 'Sheikhupura', 'Larkana'
        ];

        // Speech Recognition Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                isListening = true;
                voiceBtn.classList.add('listening');
                showVoiceFeedback("Listening... Speak now");
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                processVoiceCommand(transcript);
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                showVoiceFeedback("Error: " + event.error);
                setTimeout(hideVoiceFeedback, 2000);
            };
            
            recognition.onend = function() {
                isListening = false;
                voiceBtn.classList.remove('listening');
                setTimeout(hideVoiceFeedback, 1000);
            };
        } else {
            voiceBtn.style.display = 'none';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            getWeatherData(currentCity);
            renderCityButtons();
            
            // Start live updates
            startLiveUpdates();
            
            // Set up event listeners
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            
            voiceBtn.addEventListener('click', toggleVoiceRecognition);
            
            celsiusBtn.addEventListener('click', () => switchUnits('celsius'));
            fahrenheitBtn.addEventListener('click', () => switchUnits('fahrenheit'));
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const tabType = tab.getAttribute('data-tab');
                    renderForecast(tabType);
                });
            });
        });

        // Start live weather updates
        function startLiveUpdates() {
            // Update weather every 30 seconds
            updateInterval = setInterval(() => {
                if (currentWeatherData) {
                    updateWeatherDynamically();
                }
            }, 30000); // 30 seconds
        }

        // Update weather dynamically to simulate real changes based on current time
        function updateWeatherDynamically() {
            if (!currentWeatherData) return;
            
            const now = new Date();
            const hour = now.getHours();
            const isDaytime = hour >= 6 && hour < 18;
            
            // Winter temperature changes based on time of day
            let tempChange = 0;
            if (isDaytime) {
                // Temperature rises slightly during the day in winter
                if (hour < 14) {
                    tempChange = 0.2 + Math.random() * 0.5; // Small rise in winter
                } else {
                    tempChange = -0.2 - Math.random() * 0.5; // Small fall in winter
                }
            } else {
                // Temperature falls more at night in winter
                tempChange = -0.3 - Math.random() * 0.5;
            }
            
            // Weather condition changes
            const conditionChange = Math.random();
            let newCondition = currentWeatherData.current.description;
            let newIcon = currentWeatherData.current.icon;
            
            if (conditionChange < 0.05) { // 5% chance of weather change
                const newWeather = getWinterCondition();
                newCondition = newWeather.description;
                newIcon = newWeather.icon;
                
                // Update background based on new condition
                updateBackground(newCondition);
                
                // Animate weather icon change
                weatherIcon.classList.add('animate');
                setTimeout(() => {
                    setWeatherIcon(weatherIcon, newIcon);
                    weatherIcon.classList.remove('animate');
                }, 500);
            }
            
            // Update temperature with animation
            const currentTemp = currentWeatherData.current.temp;
            const newTemp = Math.max(-5, Math.min(25, currentTemp + tempChange)); // Winter range
            
            // Animate temperature change
            temperature.classList.add('changing');
            setTimeout(() => {
                currentWeatherData.current.temp = parseFloat(newTemp.toFixed(1));
                temperature.textContent = formatTemp(currentWeatherData.current.temp);
                temperature.classList.remove('changing');
            }, 500);
            
            // Update rain chance based on conditions
            const rainChanceChange = (Math.random() - 0.5) * 10;
            currentWeatherData.current.rainChance = Math.max(0, Math.min(100, currentWeatherData.current.rainChance + rainChanceChange));
            rainChance.textContent = `${Math.round(currentWeatherData.current.rainChance)}%`;
            
            // Update other parameters with small random variations
            const windChange = (Math.random() - 0.5) * 2;
            currentWeatherData.current.windSpeed = Math.max(0, currentWeatherData.current.windSpeed + windChange);
            windSpeed.textContent = `${currentWeatherData.current.windSpeed.toFixed(1)} km/h`;
            
            const humidityChange = (Math.random() - 0.5) * 5;
            currentWeatherData.current.humidity = Math.max(10, Math.min(95, currentWeatherData.current.humidity + humidityChange));
            humidity.textContent = `${Math.round(currentWeatherData.current.humidity)}%`;
            
            const pressureChange = (Math.random() - 0.5) * 2;
            currentWeatherData.current.pressure = Math.max(980, Math.min(1040, currentWeatherData.current.pressure + pressureChange));
            pressure.textContent = `${Math.round(currentWeatherData.current.pressure)} hPa`;
            
            // Update description if condition changed
            if (newCondition !== currentWeatherData.current.description) {
                currentWeatherData.current.description = newCondition;
                weatherDescription.textContent = newCondition;
            }
            
            // Update hourly forecast to reflect time progression
            updateHourlyForecast();
            
            // Update city buttons with new temperatures
            updateCityButtons();
            
            // Update rain forecast
            updateRainForecast();
        }

        // Update hourly forecast to shift with time
        function updateHourlyForecast() {
            if (!currentWeatherData || !currentWeatherData.hourly) return;
            
            // Remove the first hour and add a new one at the end
            currentWeatherData.hourly.shift();
            
            const lastTime = new Date(currentWeatherData.hourly[currentWeatherData.hourly.length - 1].time);
            const newTime = new Date(lastTime.getTime() + 60 * 60 * 1000); // Add one hour
            
            // Generate new hour data with winter temperatures
            const baseTemp = getMockCityData(currentCity).temp;
            const hourTemp = baseTemp + Math.sin(newTime.getHours() * Math.PI / 12) * 3; // Smaller variation in winter
            const condition = getWinterCondition();
            const rainProbability = getRainProbability(condition.description);
            
            currentWeatherData.hourly.push({
                time: newTime.toISOString(),
                temp: hourTemp,
                description: condition.description,
                icon: condition.icon,
                rainProbability: rainProbability
            });
            
            // Redisplay hourly forecast
            displayHourlyForecast(currentWeatherData.hourly);
        }

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            currentDateTime.textContent = now.toLocaleDateString('en-PK', options);
        }

        // Handle search
        function handleSearch() {
            const city = searchInput.value.trim();
            if (city) {
                currentCity = city;
                getWeatherData(city);
                searchInput.value = '';
            }
        }

        // Toggle voice recognition
        function toggleVoiceRecognition() {
            if (!recognition) {
                showVoiceFeedback("Speech recognition not supported");
                setTimeout(hideVoiceFeedback, 2000);
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        // Process voice commands
        function processVoiceCommand(transcript) {
            showVoiceFeedback(`You said: "${transcript}"`);
            
            // Check for city names
            const cities = majorCities.filter(city => 
                transcript.includes(city.toLowerCase())
            );
            
            if (cities.length > 0) {
                currentCity = cities[0];
                getWeatherData(currentCity);
                speakWeatherReport();
            } else if (transcript.includes('weather') || transcript.includes('temperature')) {
                speakWeatherReport();
            } else if (transcript.includes('forecast')) {
                speakForecast();
            } else if (transcript.includes('rain')) {
                speakRainForecast();
            } else {
                showVoiceFeedback("Sorry, I didn't understand that command");
            }
            
            setTimeout(hideVoiceFeedback, 3000);
        }

        // Speak weather report
        function speakWeatherReport() {
            if (!('speechSynthesis' in window)) {
                showVoiceFeedback("Text-to-speech not supported");
                return;
            }
            
            const weatherData = currentWeatherData || getMockWeatherData(currentCity);
            const speech = new SpeechSynthesisUtterance();
            speech.text = `The current weather in ${currentCity} is ${weatherData.current.description} with a temperature of ${Math.round(weatherData.current.temp)} degrees Celsius. The humidity is ${weatherData.current.humidity} percent and there is a ${Math.round(weatherData.current.rainChance)} percent chance of rain.`;
            speech.rate = 0.9;
            speech.pitch = 1;
            speech.volume = 1;
            
            window.speechSynthesis.speak(speech);
        }

        // Speak forecast
        function speakForecast() {
            if (!('speechSynthesis' in window)) return;
            
            const forecast = get5DayForecast();
            let forecastText = `The 5-day forecast for ${currentCity} is: `;
            
            forecast.forEach((day, index) => {
                const date = new Date(day.date);
                const dayName = date.toLocaleDateString('en-PK', { weekday: 'long' });
                forecastText += `On ${dayName}, ${day.description} with a high of ${Math.round(day.maxTemp)} and low of ${Math.round(day.minTemp)} degrees. `;
            });
            
            const speech = new SpeechSynthesisUtterance(forecastText);
            speech.rate = 0.9;
            window.speechSynthesis.speak(speech);
        }

        // Speak rain forecast
        function speakRainForecast() {
            if (!('speechSynthesis' in window)) return;
            
            const rainData = get15DayRainForecast();
            const totalRain = rainData.reduce((sum, day) => sum + day.rainfall, 0);
            const rainyDays = rainData.filter(day => day.rainfall > 0).length;
            const avgRainProbability = Math.round(rainData.reduce((sum, day) => sum + day.rainProbability, 0) / rainData.length);
            
            const speech = new SpeechSynthesisUtterance();
            speech.text = `The 15-day rain forecast for ${currentCity} shows ${rainyDays} rainy days with a total of ${totalRain.toFixed(1)} millimeters of rainfall expected. The average rain probability is ${avgRainProbability} percent.`;
            speech.rate = 0.9;
            window.speechSynthesis.speak(speech);
        }

        // Show voice feedback
        function showVoiceFeedback(message) {
            voiceText.textContent = message;
            voiceFeedback.classList.add('show');
        }

        // Hide voice feedback
        function hideVoiceFeedback() {
            voiceFeedback.classList.remove('show');
        }

        // Switch between Celsius and Fahrenheit
        function switchUnits(unit) {
            currentUnit = unit;
            
            if (unit === 'celsius') {
                celsiusBtn.classList.add('active');
                fahrenheitBtn.classList.remove('active');
            } else {
                celsiusBtn.classList.remove('active');
                fahrenheitBtn.classList.add('active');
            }
            
            // Refresh current data with new units
            if (currentWeatherData) {
                displayWeatherData(currentWeatherData);
            }
        }

        // Convert temperature based on current unit
        function convertTemp(celsius) {
            if (currentUnit === 'celsius') {
                return celsius;
            } else {
                return (celsius * 9/5) + 32;
            }
        }

        // Format temperature with unit symbol
        function formatTemp(celsius) {
            const temp = Math.round(convertTemp(celsius));
            return `${temp}°${currentUnit === 'celsius' ? 'C' : 'F'}`;
        }

        // Get weather data
        async function getWeatherData(city) {
            // Show loading state
            showLoadingState();
            
            try {
                // For demo purposes, we'll use mock data
                const mockWeatherData = getMockWeatherData(city);
                currentWeatherData = mockWeatherData;
                displayWeatherData(mockWeatherData);
                
            } catch (error) {
                console.error('Error fetching weather data:', error);
                displayError('Failed to fetch weather data. Please try again.');
            }
        }

        // Show loading state
        function showLoadingState() {
            cityName.textContent = currentCity;
            temperature.textContent = '--°C';
            weatherDescription.textContent = 'Loading...';
            windSpeed.textContent = '-- km/h';
            humidity.textContent = '--%';
            rainChance.textContent = '--%';
            pressure.textContent = '-- hPa';
            
            hourlyContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading hourly forecast...</div>
                </div>
            `;
            
            forecastContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading forecast data...</div>
                </div>
            `;
        }

        // Display weather data
        function displayWeatherData(data) {
            cityName.textContent = data.city;
            temperature.textContent = formatTemp(data.current.temp);
            weatherDescription.textContent = data.current.description;
            windSpeed.textContent = `${data.current.windSpeed} km/h`;
            humidity.textContent = `${data.current.humidity}%`;
            rainChance.textContent = `${Math.round(data.current.rainChance)}%`;
            pressure.textContent = `${data.current.pressure} hPa`;
            
            // Set weather icon
            setWeatherIcon(weatherIcon, data.current.icon);
            
            // Update background based on weather
            updateBackground(data.current.description);
            
            // Display hourly forecast
            displayHourlyForecast(data.hourly);
            
            // Display 5-day forecast by default
            renderForecast('5-day');
            
            // Display rain forecast
            displayRainForecast();
            
            // Update city buttons
            updateCityButtons();
        }

        // Update background based on weather condition
        function updateBackground(description) {
            // Remove all weather classes
            body.classList.remove('sunny', 'cloudy', 'rainy', 'night', 'winter');
            
            // Check if it's night time (6 PM to 6 AM)
            const now = new Date();
            const hour = now.getHours();
            const isNight = hour < 6 || hour >= 18;
            
            if (isNight) {
                body.classList.add('night');
            } else if (description.includes('rain') || description.includes('drizzle')) {
                body.classList.add('rainy');
            } else if (description.includes('cloud')) {
                body.classList.add('cloudy');
            } else if (description.includes('snow') || description.includes('frost')) {
                body.classList.add('winter');
            } else {
                body.classList.add('winter');
            }
        }

        // Display hourly forecast
        function displayHourlyForecast(hourlyData) {
            hourlyContainer.innerHTML = '';
            
            hourlyData.forEach((hour, index) => {
                const hourlyItem = document.createElement('div');
                hourlyItem.className = 'hourly-item';
                hourlyItem.addEventListener('click', () => openHourDetails(hour, index));
                
                const time = new Date(hour.time);
                const timeString = time.toLocaleTimeString('en-PK', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                hourlyItem.innerHTML = `
                    <div class="hourly-time">${timeString}</div>
                    <div class="hourly-icon">
                        <i class="${getWeatherIconClass(hour.icon)}"></i>
                    </div>
                    <div class="hourly-temp">${formatTemp(hour.temp)}</div>
                    <div class="hourly-rain">${hour.rainProbability}% rain</div>
                    <div class="hourly-desc" style="font-size: 0.7rem; margin-top: 5px;">${hour.description}</div>
                `;
                
                hourlyContainer.appendChild(hourlyItem);
            });
        }

        // Render forecast based on selected tab
        function renderForecast(type) {
            const forecastData = type === '5-day' ? get5DayForecast() : get15DayForecast();
            
            forecastContainer.innerHTML = '';
            
            forecastData.forEach((day, index) => {
                const forecastCard = document.createElement('div');
                forecastCard.className = 'forecast-card';
                forecastCard.addEventListener('click', () => openDayDetails(day, index));
                
                const date = new Date(day.date);
                const options = { weekday: 'short', month: 'short', day: 'numeric' };
                const formattedDate = date.toLocaleDateString('en-PK', options);
                
                forecastCard.innerHTML = `
                    <div class="forecast-date">${formattedDate}</div>
                    <div class="forecast-icon">
                        <i class="${getWeatherIconClass(day.icon)}"></i>
                    </div>
                    <div class="forecast-temp">${formatTemp(day.maxTemp)}</div>
                    <div class="forecast-desc">${day.description}</div>
                    <div class="forecast-details">
                        <div class="forecast-detail">
                            <i class="fas fa-tint"></i>
                            <span>${day.humidity}%</span>
                        </div>
                        <div class="forecast-detail">
                            <i class="fas fa-cloud-rain"></i>
                            <span>${day.rainProbability}%</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; justify-content: space-around;">
                        <div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">Min</div>
                            <div>${formatTemp(day.minTemp)}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.7rem; opacity: 0.8;">Max</div>
                            <div>${formatTemp(day.maxTemp)}</div>
                        </div>
                    </div>
                `;
                
                forecastContainer.appendChild(forecastCard);
            });
        }

        // Display rain forecast
        function displayRainForecast() {
            const rainData = get15DayRainForecast();
            
            // Clear previous chart
            rainChart.innerHTML = '';
            
            // Find maximum rainfall for scaling
            const maxRainfall = Math.max(...rainData.map(day => day.rainfall));
            
            // Create rain bars
            rainData.forEach((day, index) => {
                const rainBar = document.createElement('div');
                rainBar.className = 'rain-bar';
                rainBar.addEventListener('click', () => openRainDayDetails(day, index));
                
                const date = new Date(day.date);
                const dateString = date.toLocaleDateString('en-PK', { 
                    day: 'numeric', 
                    month: 'short' 
                });
                
                // Calculate bar height (max 120px)
                const barHeight = maxRainfall > 0 ? (day.rainfall / maxRainfall) * 120 : 0;
                
                rainBar.innerHTML = `
                    <div class="rain-amount">${day.rainfall.toFixed(1)}mm</div>
                    <div class="rain-bar-fill" style="height: ${barHeight}px"></div>
                    <div class="rain-date">${dateString}</div>
                    <div class="rain-probability">${day.rainProbability}% chance</div>
                `;
                
                rainChart.appendChild(rainBar);
            });
            
            // Update rain summary
            updateRainSummary(rainData);
        }

        // Update rain summary
        function updateRainSummary(rainData) {
            const totalRain = rainData.reduce((sum, day) => sum + day.rainfall, 0);
            const rainyDays = rainData.filter(day => day.rainfall > 0).length;
            const maxRainfall = Math.max(...rainData.map(day => day.rainfall));
            const avgRainProbability = Math.round(rainData.reduce((sum, day) => sum + day.rainProbability, 0) / rainData.length);
            
            rainSummary.innerHTML = `
                <div class="rain-stat" onclick="openRainDetails()">
                    <div class="rain-stat-value">${totalRain.toFixed(1)}mm</div>
                    <div class="rain-stat-label">Total Rainfall</div>
                </div>
                <div class="rain-stat" onclick="openRainDetails()">
                    <div class="rain-stat-value">${rainyDays}</div>
                    <div class="rain-stat-label">Rainy Days</div>
                </div>
                <div class="rain-stat" onclick="openRainDetails()">
                    <div class="rain-stat-value">${avgRainProbability}%</div>
                    <div class="rain-stat-label">Avg Chance</div>
                </div>
            `;
        }

        // Update rain forecast dynamically
        function updateRainForecast() {
            const rainData = get15DayRainForecast();
            updateRainSummary(rainData);
        }

        // Render city buttons
        function renderCityButtons() {
            citiesContainer.innerHTML = '';
            
            majorCities.forEach(city => {
                const cityData = getMockCityData(city);
                const cityBtn = document.createElement('button');
                cityBtn.className = 'city-btn';
                cityBtn.setAttribute('data-city', city);
                
                if (city === currentCity) {
                    cityBtn.classList.add('active');
                }
                
                cityBtn.innerHTML = `
                    <div class="city-name">${city}</div>
                    <div class="city-temp">${formatTemp(cityData.temp)}</div>
                    <div style="font-size: 0.8rem; opacity: 0.8;">${cityData.description}</div>
                `;
                
                cityBtn.addEventListener('click', () => {
                    currentCity = city;
                    getWeatherData(city);
                });
                
                citiesContainer.appendChild(cityBtn);
            });
        }

        // Update city buttons active state
        function updateCityButtons() {
            document.querySelectorAll('.city-btn').forEach(btn => {
                if (btn.getAttribute('data-city') === currentCity) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Set weather icon based on condition
        function setWeatherIcon(iconElement, iconCode) {
            iconElement.className = getWeatherIconClass(iconCode);
        }

        // Get appropriate Font Awesome class based on weather condition
        function getWeatherIconClass(iconCode) {
            const iconMap = {
                '01d': 'fas fa-sun',
                '01n': 'fas fa-moon',
                '02d': 'fas fa-cloud-sun',
                '02n': 'fas fa-cloud-moon',
                '03d': 'fas fa-cloud',
                '03n': 'fas fa-cloud',
                '04d': 'fas fa-cloud',
                '04n': 'fas fa-cloud',
                '09d': 'fas fa-cloud-rain',
                '09n': 'fas fa-cloud-rain',
                '10d': 'fas fa-cloud-sun-rain',
                '10n': 'fas fa-cloud-moon-rain',
                '11d': 'fas fa-bolt',
                '11n': 'fas fa-bolt',
                '13d': 'fas fa-snowflake',
                '13n': 'fas fa-snowflake',
                '50d': 'fas fa-smog',
                '50n': 'fas fa-smog'
            };
            
            return iconMap[iconCode] || 'fas fa-cloud';
        }

        // Display error message
        function displayError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <span style="margin-left: 10px;">${message}</span>
            `;
            
            const weatherContainer = document.getElementById('weather-container');
            if (weatherContainer) {
                weatherContainer.insertBefore(errorDiv, weatherContainer.firstChild);
            } else {
                document.querySelector('.main-content').insertBefore(errorDiv, document.querySelector('.current-weather'));
            }
            
            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Get rain probability based on weather condition
        function getRainProbability(description) {
            if (description.includes('rain') || description.includes('shower')) {
                return Math.floor(Math.random() * 30) + 70; // 70-100% for rainy conditions
            } else if (description.includes('cloud')) {
                return Math.floor(Math.random() * 40) + 20; // 20-60% for cloudy conditions
            } else {
                return Math.floor(Math.random() * 20); // 0-20% for clear conditions
            }
        }

        // Mock data functions (in a real app, these would be API calls)
        function getMockWeatherData(city) {
            const cityData = getMockCityData(city);
            
            // Generate hourly forecast for the next 24 hours
            const hourly = [];
            const now = new Date();
            
            for (let i = 0; i < 24; i++) {
                const time = new Date(now);
                time.setHours(now.getHours() + i);
                
                // Vary temperature throughout the day with winter temperatures
                const hourTemp = cityData.temp + Math.sin(i * Math.PI / 12) * 3; // Smaller variation in winter
                const condition = getWinterCondition();
                const rainProbability = getRainProbability(condition.description);
                
                hourly.push({
                    time: time.toISOString(),
                    temp: hourTemp,
                    description: condition.description,
                    icon: condition.icon,
                    rainProbability: rainProbability
                });
            }
            
            return {
                city: city,
                current: {
                    temp: cityData.temp,
                    feelsLike: cityData.temp - 2,
                    description: cityData.description,
                    icon: cityData.icon,
                    humidity: 40 + Math.floor(Math.random() * 30),
                    windSpeed: 5 + Math.floor(Math.random() * 15),
                    pressure: 1010 + Math.floor(Math.random() * 20),
                    rainChance: getRainProbability(cityData.description)
                },
                hourly: hourly
            };
        }

        function get5DayForecast() {
            const forecast = [];
            const today = new Date();
            
            for (let i = 1; i <= 5; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const condition = getWinterCondition();
                const baseTemp = getMockCityData(currentCity).temp;
                const maxTemp = baseTemp + Math.floor(Math.random() * 4) - 1; // Smaller range in winter
                const minTemp = baseTemp - 3 - Math.floor(Math.random() * 3); // Colder nights in winter
                const rainProbability = getRainProbability(condition.description);
                
                forecast.push({
                    date: date.toISOString(),
                    description: condition.description,
                    icon: condition.icon,
                    maxTemp: maxTemp,
                    minTemp: minTemp,
                    humidity: 40 + Math.floor(Math.random() * 40),
                    windSpeed: 5 + Math.floor(Math.random() * 15),
                    rainProbability: rainProbability
                });
            }
            
            return forecast;
        }

        function get15DayForecast() {
            const forecast = [];
            const today = new Date();
            
            for (let i = 1; i <= 15; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const condition = getWinterCondition();
                const baseTemp = getMockCityData(currentCity).temp;
                const maxTemp = baseTemp + Math.floor(Math.random() * 6) - 2; // Smaller range in winter
                const minTemp = baseTemp - 5 - Math.floor(Math.random() * 4); // Colder nights in winter
                const rainProbability = getRainProbability(condition.description);
                
                forecast.push({
                    date: date.toISOString(),
                    description: condition.description,
                    icon: condition.icon,
                    maxTemp: maxTemp,
                    minTemp: minTemp,
                    humidity: 40 + Math.floor(Math.random() * 40),
                    windSpeed: 5 + Math.floor(Math.random() * 15),
                    rainProbability: rainProbability
                });
            }
            
            return forecast;
        }

        function get15DayRainForecast() {
            const rainForecast = [];
            const today = new Date();
            
            for (let i = 1; i <= 15; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                // Generate realistic rainfall data with some rainy days
                const isRainyDay = Math.random() < 0.3; // 30% chance of rain
                let rainfall = 0;
                let rainProbability = 0;
                
                if (isRainyDay) {
                    // Generate rainfall amount between 0.5mm and 25mm
                    rainfall = Math.random() * 25;
                    // Make heavier rainfall less likely
                    rainfall = Math.min(rainfall, Math.random() * 15);
                    rainProbability = Math.floor(Math.random() * 30) + 70; // 70-100% for rainy days
                } else {
                    rainProbability = Math.floor(Math.random() * 30); // 0-30% for non-rainy days
                }
                
                rainForecast.push({
                    date: date.toISOString(),
                    rainfall: parseFloat(rainfall.toFixed(1)),
                    rainProbability: rainProbability
                });
            }
            
            return rainForecast;
        }

        function getMockCityData(city) {
            // Winter temperatures for different cities in Pakistan
            const cityData = {
                'Karachi': { temp: 22, description: 'Partly Cloudy' },
                'Lahore': { temp: 15, description: 'Clear' },
                'Islamabad': { temp: 12, description: 'Sunny' },
                'Rawalpindi': { temp: 13, description: 'Sunny' },
                'Peshawar': { temp: 14, description: 'Mostly Sunny' },
                'Quetta': { temp: 8, description: 'Clear' },
                'Faisalabad': { temp: 16, description: 'Sunny' },
                'Multan': { temp: 18, description: 'Partly Cloudy' },
                'Gujranwala': { temp: 15, description: 'Partly Cloudy' },
                'Sialkot': { temp: 14, description: 'Clear' },
                'Sargodha': { temp: 16, description: 'Sunny' },
                'Bahawalpur': { temp: 19, description: 'Partly Cloudy' },
                'Sukkur': { temp: 20, description: 'Sunny' },
                'Jhang': { temp: 17, description: 'Sunny' },
                'Sheikhupura': { temp: 15, description: 'Partly Cloudy' },
                'Larkana': { temp: 19, description: 'Sunny' }
            };
            
            const data = cityData[city] || { temp: 15, description: 'Clear' };
            data.icon = getConditionIcon(data.description);
            return data;
        }

        function getWinterCondition() {
            const conditions = [
                { description: 'clear sky', icon: '01d' },
                { description: 'few clouds', icon: '02d' },
                { description: 'scattered clouds', icon: '03d' },
                { description: 'broken clouds', icon: '04d' },
                { description: 'shower rain', icon: '09d' },
                { description: 'rain', icon: '10d' },
                { description: 'light rain', icon: '10d' },
                { description: 'moderate rain', icon: '10d' },
                { description: 'overcast clouds', icon: '04d' },
                { description: 'mist', icon: '50d' },
                { description: 'fog', icon: '50d' },
                { description: 'light snow', icon: '13d' }
            ];
            
            return conditions[Math.floor(Math.random() * conditions.length)];
        }

        function getConditionIcon(description) {
            const iconMap = {
                'Sunny': '01d',
                'Partly Cloudy': '02d',
                'Clear': '01d',
                'Mostly Sunny': '02d',
                'Overcast': '04d'
            };
            
            return iconMap[description] || '01d';
        }

        // Functions to open detailed pages
        function openWeatherDetails() {
            const weatherData = currentWeatherData || getMockWeatherData(currentCity);
            const detailsPage = generateWeatherDetailsPage(weatherData);
            openNewPage(detailsPage, 'Weather Details - ' + currentCity);
        }

        function openRainDetails() {
            const rainData = get15DayRainForecast();
            const detailsPage = generateRainDetailsPage(rainData);
            openNewPage(detailsPage, 'Rain Forecast Details - ' + currentCity);
        }

        function openHourDetails(hourData, index) {
            const detailsPage = generateHourDetailsPage(hourData, index);
            openNewPage(detailsPage, 'Hourly Forecast - ' + currentCity);
        }

        function openDayDetails(dayData, index) {
            const detailsPage = generateDayDetailsPage(dayData, index);
            openNewPage(detailsPage, 'Daily Forecast - ' + currentCity);
        }

        function openRainDayDetails(dayData, index) {
            const detailsPage = generateRainDayDetailsPage(dayData, index);
            openNewPage(detailsPage, 'Rain Day Details - ' + currentCity);
        }

        function openNewPage(content, title) {
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title}</title>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            margin: 0;
                            padding: 20px;
                            background: linear-gradient(135deg, #0f4c75, #3282b8, #bbe1fa);
                            color: white;
                            min-height: 100vh;
                        }
                        .container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: rgba(255, 255, 255, 0.1);
                            border-radius: 20px;
                            padding: 25px;
                            backdrop-filter: blur(10px);
                            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 25px;
                            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                            padding-bottom: 15px;
                        }
                        .details-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                            gap: 15px;
                            margin-top: 20px;
                        }
                        .detail-card {
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 15px;
                            padding: 15px;
                            text-align: center;
                        }
                        .detail-card i {
                            font-size: 2rem;
                            margin-bottom: 10px;
                            color: #4fc3f7;
                        }
                        .detail-value {
                            font-size: 1.5rem;
                            font-weight: bold;
                            margin: 10px 0;
                        }
                        .detail-label {
                            font-size: 0.9rem;
                            opacity: 0.8;
                        }
                        .back-btn {
                            display: inline-block;
                            margin-top: 20px;
                            padding: 10px 20px;
                            background: rgba(255, 255, 255, 0.2);
                            border-radius: 10px;
                            text-decoration: none;
                            color: white;
                            transition: all 0.3s ease;
                        }
                        .back-btn:hover {
                            background: rgba(255, 255, 255, 0.3);
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        ${content}
                    </div>
                </body>
                </html>
            `);
            newWindow.document.close();
        }

        function generateWeatherDetailsPage(weatherData) {
            return `
                <div class="header">
                    <h1><i class="fas fa-cloud-sun"></i> Weather Details</h1>
                    <h2>${currentCity}</h2>
                    <p>Current Conditions</p>
                </div>
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-thermometer-half"></i>
                        <div class="detail-value">${formatTemp(weatherData.current.temp)}</div>
                        <div class="detail-label">Temperature</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-tint"></i>
                        <div class="detail-value">${weatherData.current.humidity}%</div>
                        <div class="detail-label">Humidity</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-wind"></i>
                        <div class="detail-value">${weatherData.current.windSpeed} km/h</div>
                        <div class="detail-label">Wind Speed</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-compress-arrows-alt"></i>
                        <div class="detail-value">${weatherData.current.pressure} hPa</div>
                        <div class="detail-label">Pressure</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="detail-value">${Math.round(weatherData.current.rainChance)}%</div>
                        <div class="detail-label">Rain Chance</div>
                    </div>
                    <div class="detail-card">
                        <i class="${getWeatherIconClass(weatherData.current.icon)}"></i>
                        <div class="detail-value">${weatherData.current.description}</div>
                        <div class="detail-label">Condition</div>
                    </div>
                </div>
                <a href="javascript:window.close()" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Weather App</a>
            `;
        }

        function generateRainDetailsPage(rainData) {
            const totalRain = rainData.reduce((sum, day) => sum + day.rainfall, 0);
            const rainyDays = rainData.filter(day => day.rainfall > 0).length;
            const maxRainfall = Math.max(...rainData.map(day => day.rainfall));
            const avgRainProbability = Math.round(rainData.reduce((sum, day) => sum + day.rainProbability, 0) / rainData.length);
            
            return `
                <div class="header">
                    <h1><i class="fas fa-cloud-rain"></i> Rain Forecast Details</h1>
                    <h2>${currentCity}</h2>
                    <p>15-Day Rain Analysis</p>
                </div>
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-tint"></i>
                        <div class="detail-value">${totalRain.toFixed(1)}mm</div>
                        <div class="detail-label">Total Rainfall</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="detail-value">${rainyDays}</div>
                        <div class="detail-label">Rainy Days</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-chart-line"></i>
                        <div class="detail-value">${maxRainfall.toFixed(1)}mm</div>
                        <div class="detail-label">Max Daily Rainfall</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-percentage"></i>
                        <div class="detail-value">${avgRainProbability}%</div>
                        <div class="detail-label">Avg Rain Probability</div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3>Daily Breakdown</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                        ${rainData.map(day => {
                            const date = new Date(day.date);
                            const dateString = date.toLocaleDateString('en-PK', { 
                                weekday: 'short', 
                                month: 'short', 
                                day: 'numeric' 
                            });
                            return `
                                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 10px; text-align: center;">
                                    <div style="font-size: 0.8rem;">${dateString}</div>
                                    <div style="font-size: 1.2rem; font-weight: bold; margin: 5px 0;">${day.rainfall.toFixed(1)}mm</div>
                                    <div style="font-size: 0.7rem; color: #4a90e2;">${day.rainProbability}% chance</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                <a href="javascript:window.close()" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Weather App</a>
            `;
        }

        function generateHourDetailsPage(hourData, index) {
            const time = new Date(hourData.time);
            const timeString = time.toLocaleTimeString('en-PK', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            
            return `
                <div class="header">
                    <h1><i class="fas fa-clock"></i> Hourly Forecast Details</h1>
                    <h2>${currentCity}</h2>
                    <p>${timeString}</p>
                </div>
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-thermometer-half"></i>
                        <div class="detail-value">${formatTemp(hourData.temp)}</div>
                        <div class="detail-label">Temperature</div>
                    </div>
                    <div class="detail-card">
                        <i class="${getWeatherIconClass(hourData.icon)}"></i>
                        <div class="detail-value">${hourData.description}</div>
                        <div class="detail-label">Condition</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="detail-value">${hourData.rainProbability}%</div>
                        <div class="detail-label">Rain Probability</div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3>Additional Information</h3>
                    <p>This hourly forecast shows expected weather conditions for ${timeString}.</p>
                    <p>The temperature is expected to be around ${formatTemp(hourData.temp)} with ${hourData.description} conditions.</p>
                    <p>There is a ${hourData.rainProbability}% chance of precipitation during this hour.</p>
                </div>
                <a href="javascript:window.close()" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Weather App</a>
            `;
        }

        function generateDayDetailsPage(dayData, index) {
            const date = new Date(dayData.date);
            const dateString = date.toLocaleDateString('en-PK', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            return `
                <div class="header">
                    <h1><i class="fas fa-calendar-day"></i> Daily Forecast Details</h1>
                    <h2>${currentCity}</h2>
                    <p>${dateString}</p>
                </div>
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-temperature-high"></i>
                        <div class="detail-value">${formatTemp(dayData.maxTemp)}</div>
                        <div class="detail-label">High Temperature</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-temperature-low"></i>
                        <div class="detail-value">${formatTemp(dayData.minTemp)}</div>
                        <div class="detail-label">Low Temperature</div>
                    </div>
                    <div class="detail-card">
                        <i class="${getWeatherIconClass(dayData.icon)}"></i>
                        <div class="detail-value">${dayData.description}</div>
                        <div class="detail-label">Condition</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-tint"></i>
                        <div class="detail-value">${dayData.humidity}%</div>
                        <div class="detail-label">Humidity</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-wind"></i>
                        <div class="detail-value">${dayData.windSpeed} km/h</div>
                        <div class="detail-label">Wind Speed</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-cloud-rain"></i>
                        <div class="detail-value">${dayData.rainProbability}%</div>
                        <div class="detail-label">Rain Chance</div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3>Weather Summary</h3>
                    <p>On ${dateString}, expect ${dayData.description} conditions with a high of ${formatTemp(dayData.maxTemp)} and a low of ${formatTemp(dayData.minTemp)}.</p>
                    <p>Humidity will be around ${dayData.humidity}% with winds at ${dayData.windSpeed} km/h.</p>
                    <p>There is a ${dayData.rainProbability}% chance of precipitation throughout the day.</p>
                </div>
                <a href="javascript:window.close()" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Weather App</a>
            `;
        }

        function generateRainDayDetailsPage(dayData, index) {
            const date = new Date(dayData.date);
            const dateString = date.toLocaleDateString('en-PK', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            return `
                <div class="header">
                    <h1><i class="fas fa-cloud-rain"></i> Rain Day Details</h1>
                    <h2>${currentCity}</h2>
                    <p>${dateString}</p>
                </div>
                <div class="details-grid">
                    <div class="detail-card">
                        <i class="fas fa-tint"></i>
                        <div class="detail-value">${dayData.rainfall.toFixed(1)}mm</div>
                        <div class="detail-label">Expected Rainfall</div>
                    </div>
                    <div class="detail-card">
                        <i class="fas fa-percentage"></i>
                        <div class="detail-value">${dayData.rainProbability}%</div>
                        <div class="detail-label">Rain Probability</div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3>Rain Forecast Analysis</h3>
                    <p>On ${dateString}, there is a ${dayData.rainProbability}% chance of precipitation.</p>
                    <p>If it does rain, expected rainfall amounts are around ${dayData.rainfall.toFixed(1)} millimeters.</p>
                    ${dayData.rainfall > 10 ? 
                        '<p><strong>Heavy rainfall warning:</strong> This amount of rainfall may cause localized flooding in low-lying areas.</p>' : 
                        dayData.rainfall > 5 ? 
                        '<p><strong>Moderate rainfall:</strong> Umbrella recommended for outdoor activities.</p>' : 
                        '<p><strong>Light rainfall:</strong> May not significantly impact outdoor plans.</p>'
                    }
                </div>
                <a href="javascript:window.close()" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Weather App</a>
            `;
        }
    </script>
</body>
</html>